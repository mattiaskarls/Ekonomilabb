---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const latestPosts = (await getCollection("kunskap"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const allResources = (await getCollection("resurser")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const featuredResources = allResources.filter((r) => r.data.featured);
const fillResources = allResources.filter((r) => !r.data.featured);
const selectedResources = [...featuredResources, ...fillResources].slice(0, 3);

const btnPrimary =
  "inline-flex items-center justify-center rounded-xl bg-[var(--gold)] hover:bg-[var(--gold-hover)] text-black font-medium px-5 py-3 transition";

const btnSecondary =
  "inline-flex items-center justify-center rounded-xl border border-[var(--border)] bg-[var(--surface)] text-[var(--text)] hover:text-[var(--gold)] hover:border-[var(--gold)] font-medium px-5 py-3 transition";

const card =
  "rounded-2xl border border-[var(--border)] bg-[var(--surface)]/70";

const cardInner = "p-5 space-y-4";

const subtleBtn =
  "inline-flex items-center justify-center rounded-xl border border-[var(--border)] bg-[var(--surface-soft)] hover:border-[var(--gold)] text-[var(--text)] px-4 py-2 transition";

const textLink =
  "text-sm text-[var(--text-muted)] hover:text-[var(--gold)] transition";
---

<BaseLayout title="Ekonomismedjan – smid din framtida ekonomi">
  <!-- HERO -->
  <section class="pt-6 pb-12">
    <div class="text-center space-y-6">
      <div class="inline-flex items-center gap-2 rounded-full border border-[var(--border)] bg-[var(--surface)] px-3 py-1 text-xs text-[var(--text-muted)]">
        <span class="h-2 w-2 rounded-full bg-[var(--gold)]"></span>
        Verktyg + guider för att smida din ekonomi
      </div>

      <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">
        Smid din framtida ekonomi
      </h1>

      <p class="max-w-3xl mx-auto text-base md:text-lg leading-relaxed">
        Du jobbar, sparar på ISK och bygger pensionskapital. Men hur hänger allt ihop över tid?
        När kan du sluta jobba? Hur påverkar lön, sparande och företagande varandra?
      </p>

      <p class="max-w-3xl mx-auto text-sm md:text-base text-[var(--text-muted)]">
        Ekonomismedjan hjälper dig modellera helheten så att du fattar beslut baserat på siffror – inte känsla.
      </p>

      <div class="flex flex-col sm:flex-row gap-3 justify-center pt-2">
        <a href="/verktyg/" class={btnPrimary}>Utforska verktygen</a>
        <a href="/kunskap/" class={btnSecondary}>Börja med kunskap</a>
      </div>
    </div>
  </section>

  <!-- FEATURE BLOCKS -->
  <section class="pb-14">
    <div class="grid gap-6 md:grid-cols-3">
      {[
        {
          title: "FIRE & pension",
          image: "/images/fireochpension.png",
          alt: "FIRE och pension – ikon",
          text: "Modellera lön, ISK och pension – se helheten över livet.",
          bullets: [
            "När kan du sluta jobba?",
            "Månadsinkomst efter FIRE",
            "ISK: uppbyggnad → uttag",
          ],
          tool: "/verktyg/fire-pension/",
        },
        {
          title: "Jag & mitt AB",
          image: "/images/jagochmittab.png",
          alt: "Jag och mitt AB – ikon",
          text: "För dig med aktiebolag – förstå lön, utdelning och TJP.",
          bullets: [
            "Jämför scenarier",
            "Effekt på bolag & privat",
            "Steg-för-steg-guide",
          ],
          tool: "/verktyg/jag-och-mitt-ab/",
        },
        {
          title: "Kunskap & resurser",
          image: "/images/kunskap.png",
          alt: "Kunskap och resurser – ikon",
          text: "Principer, artiklar och samlade resurser.",
          bullets: [
            "ISK & långsiktighet",
            "FIRE som plan",
            "Resurser (sen affiliate)",
          ],
          tool: "/kunskap/",
        },
      ].map((c) => (
        <div class={card}>
          <div class={cardInner}>
            <img
              src={c.image}
              alt={c.alt}
              class="h-12 w-12 object-contain"
              loading="lazy"
            />

            <h2 class="text-lg font-semibold">{c.title}</h2>
            <p class="text-sm text-[var(--text-muted)]">{c.text}</p>

            <ul class="text-sm space-y-1">
              {c.bullets.map((b) => (
                <li class="flex gap-2">
                  <span class="text-[var(--gold)]">•</span>
                  {b}
                </li>
              ))}
            </ul>

            <a href={c.tool} class={subtleBtn}>
              Öppna →
            </a>
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- LATEST -->
  <section class="pb-16">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold">Senaste artiklar</h2>
      <a href="/kunskap/" class={textLink}>Visa alla →</a>
    </div>

    <div class="grid gap-6 md:grid-cols-3">
      {latestPosts.map((post) => (
        <a
          href={`/kunskap/${post.slug}/`}
          class="block rounded-2xl border border-[var(--border)] bg-[var(--surface)] p-5 hover:border-[var(--gold)] transition"
        >
          <p class="text-xs text-[var(--text-muted)]">
            {post.data.date.toLocaleDateString("sv-SE")}
          </p>
          <h3 class="text-lg font-semibold mt-1">{post.data.title}</h3>
          <p class="text-sm text-[var(--text-muted)] mt-2">
            {post.data.excerpt}
          </p>
        </a>
      ))}
    </div>
  </section>

  <!-- FOOTER NOTE -->
  <section class="pb-4 border-t border-[var(--border)] pt-6">
    <p class="text-xs text-[var(--text-muted)] max-w-3xl">
      Disclaimer: Innehållet är utbildning och allmän information – inte personlig investeringsrådgivning.
    </p>
  </section>
</BaseLayout>
