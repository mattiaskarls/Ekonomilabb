---
// src/pages/index.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// -----------------------------
// 1) Handplockade “vägar” (router)
// -----------------------------
const paths = [
  {
    title: "Guidad start – 40+",
    body:
      "Börja med fakta: pension, sparande och en enkel plan. Inga genvägar, bara struktur.",
    steps: [
      "Lär dig grunderna: tid, risk, buffert och börsen",
      "Få koll på din pension & ISK",
      "Stoppa in dina siffror i kalkylatorn",
    ],
    ctas: [
      { label: "Börja här →", href: "/kunskap/tanka-kring-sparande/" },
      { label: "FIRE & pension – kalkylator →", href: "/verktyg/fire-pension/" },
    ],
    badge: "Start",
    highlight: true,
  },
  {
    title: "Vill du förstå FIRE på riktigt?",
    body:
      "Lär dig vad FIRE faktiskt innebär, hur 4%-regeln används och hur du sanity-checkar resultatet.",
    bullets: ["Vad FIRE är (och inte är)", "4%-regeln i praktiken", "Risk, rimlighet och vanliga misstag"],
    ctas: [
      { label: "Kunskap →", href: "/kunskap/" },
      { label: "Verktyg för FIRE →", href: "/verktyg/" },
    ],
    badge: "FIRE",
    highlight: false,
  },
  {
    title: "Egenföretagare?",
    body:
      "Förstå först hur lön, utdelning och pension påverkar din privatekonomi över tid.",
    bullets: ["Jämför lön, utdelning och pension", "Se effekten för dig privat och ditt bolag", "Pedagogiskt steg-för-steg"],
    ctas: [{ label: "Jag & mitt AB →", href: "/verktyg/jag-och-mitt-ab/" }],
    badge: "AB",
    highlight: false,
  },
] as const;

// -----------------------------
// 2) Verktyg (handplockad lista – inga beroenden)
// -----------------------------
const tools = [
  {
    title: "FIRE & pension",
    desc: "Modellera lön, ISK och pension – se helheten över tid.",
    bullets: [
      "Se när du kan sluta jobba",
      "Följ månadsinkomst före/efter pension",
      "Förstå ISK:s uppbyggnad och uttagsfaser",
    ],
    href: "/verktyg/fire-pension/",
  },
  {
    title: "FIRE & pension – guide",
    desc: "Steg-för-steg: antaganden, fält och tolkning av resultatet.",
    bullets: ["Vad varje fält betyder", "Hur du tolkar resultatet", "Vanliga misstag + rimlighetstester"],
    href: "/verktyg/fire-pension-guide/",
  },
  {
    title: "Jag & mitt AB",
    desc: "För dig som driver aktiebolag och vill förstå lön vs utdelning vs TJP.",
    bullets: [
      "Jämför lön, utdelning och TJP",
      "Se effekt på bolag och privatekonomi",
      "Pedagogisk guide steg för steg",
    ],
    href: "/verktyg/jag-och-mitt-ab/",
  },
  {
    title: "Snabbverktyg",
    desc: "Ränta-på-ränta, 4%-regeln och snabba sanity checks.",
    bullets: ["Ränta-på-ränta med månadssparande", "Uttagsnivåer enligt 4%-regeln", "Snabba överslag"],
    href: "/verktyg/snabbverktyg/",
  },
  {
    title: "Tajma Marknaden – spel",
    desc: "Testa om du faktiskt slår köp & behåll. Spoiler: oftast inte.",
    bullets: ["Köp och sälj under 10 år", "Försök köpa billigt och sälja dyrt", "Jämför mot månadsparande"],
    href: "/verktyg/tajma-marknaden/",
  },
  {
    title: "Besparingar över tid",
    desc: "Se hur små och stora besparingar växer över tid.",
    bullets: ["Engångs- och löpande besparingar", "Hur mycket sparar du över tid?", "Är småutgifter verkligen små?"],
    href: "/verktyg/besparingar-over-tid/",
  },
  {
    title: "Tid till FIRE",
    desc: "Se hur extra sparande eller ökade kostnader påverkar din tid till frihet.",
    bullets: ["Effekt av extra kostnader", "Effekt av extra sparande", "En enkel översikt"],
    href: "/verktyg/tid-till-fire/",
  },
  {
    title: "Rik eller Fri?",
    desc: "Jämför två scenarier: rik livsstil vs fri livsstil.",
    bullets: ["Leva som en kung och jobba länge?", "Snåla och bli fri snabbt?", "Eller något mitt emellan?"],
    href: "/verktyg/rik-eller-fri/",
  },
] as const;

// -----------------------------
// 3) Kunskap – välj 3 “K1-navet” manuellt
// -----------------------------
const allPosts = await getCollection("kunskap");
type Post = (typeof allPosts)[number];

const K1_SLUGS = [
  "tanka-kring-sparande",
  "isk",
  "risk-avkastning-beteende",
] as const;

const postBySlug = new Map<string, Post>(allPosts.map((p) => [p.slug, p]));
function isPost(x: Post | undefined): x is Post {
  return Boolean(x);
}
const featuredPosts = K1_SLUGS.map((s) => postBySlug.get(s)).filter(isPost);

// -----------------------------
// 4) Resurser – 3 “kategorier” för monetisering utan sälj
// -----------------------------
const allResources = await getCollection("resurser");
type Resource = (typeof allResources)[number];
const resBySlug = new Map<string, Resource>(allResources.map((r) => [r.slug, r]));

const featuredResources = [
  { title: "Automatiserat sparande", slug: "lysa" },
  { title: "Välj själv", slug: "avanza" },
  { title: "Överblick & fakta", slug: "minpension" },
].map((x) => ({ ...x, item: resBySlug.get(x.slug) }));

// -----------------------------
// UI helpers (matchar din design-token-stil)
// -----------------------------
const sectionCard = "rounded-2xl border border-[var(--border)] bg-[var(--surface)]/70";
const card = "rounded-2xl border border-[var(--border)] bg-[var(--surface)] p-6 transition hover:border-[var(--gold)]";
const subtle = "text-[var(--text-muted)]";
const btnPrimary =
  "inline-flex items-center justify-center rounded-xl bg-[var(--gold)] px-5 py-3 text-sm font-semibold text-black hover:brightness-110 transition";
const btnSecondary =
  "inline-flex items-center justify-center rounded-xl border border-[var(--border)] bg-[var(--surface)] px-5 py-3 text-sm font-semibold hover:border-[var(--gold)] transition";
const btnGhost =
  "inline-flex items-center justify-center rounded-xl border border-[var(--border)] bg-transparent px-4 py-2 text-sm hover:border-[var(--gold)] transition";
---

<BaseLayout title="EkonomiSmedjan – Smid din framtida ekonomi">
  <!-- HERO -->
  <section class="pt-10 md:pt-14 pb-10 text-center">
    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-[var(--border)] bg-[var(--surface)]/70 text-xs mb-6">
      <span class="h-2 w-2 rounded-full bg-[var(--gold)]"></span>
      <span class={subtle}>Verktyg + guider för din ekonomi</span>
    </div>

    <h1 class="text-3xl md:text-5xl font-semibold tracking-tight">
      Smid din framtida ekonomi
    </h1>

    <p class={`max-w-2xl mx-auto mt-4 text-base md:text-lg leading-relaxed ${subtle}`}>
      Förstå sambanden mellan lön, sparande och pension. Testa hur dina val idag påverkar din ekonomi över tid.
    </p>

    <div class="flex flex-col sm:flex-row gap-3 justify-center mt-6">
      <a href="/verktyg/fire-pension/" class={btnPrimary}>Räkna på FIRE & pension</a>
      <a href="/kunskap/tanka-kring-sparande/" class={btnSecondary}>Börja här →</a>
    </div>
  </section>

  <!-- VÄLJ DIN VÄG -->
  <section class="pb-12">
    <div class="grid gap-5 lg:grid-cols-3">
      {paths.map((p) => (
        <div class={`${card} ${p.highlight ? "border-[var(--gold)]/40" : ""}`}>
          <div class="flex items-center justify-between gap-3 mb-3">
            <h2 class="text-lg font-semibold">{p.title}</h2>
            <span class="text-xs px-2 py-1 rounded-full border border-[var(--border)] bg-[var(--surface-soft)]">
              {p.badge}
            </span>
          </div>

          <p class={`text-sm leading-relaxed ${subtle}`}>{p.body}</p>

          {"steps" in p && p.steps ? (
            <ol class="mt-4 space-y-2 text-sm">
              {p.steps.map((s, idx) => (
                <li class="flex gap-3">
                  <span class="text-[var(--gold)] font-semibold w-4">{idx + 1}</span>
                  <span class={subtle}>{s}</span>
                </li>
              ))}
            </ol>
          ) : null}

          {"bullets" in p && p.bullets ? (
            <ul class="mt-4 space-y-2 text-sm">
              {p.bullets.map((b) => (
                <li class="flex gap-3">
                  <span class="text-[var(--gold)]">›</span>
                  <span class={subtle}>{b}</span>
                </li>
              ))}
            </ul>
          ) : null}

          <div class="mt-6 flex flex-wrap gap-3">
            {p.ctas.map((c) => (
              <a href={c.href} class={btnGhost}>
                {c.label}
              </a>
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- UTVALDA VERKTYG -->
  <section class="pb-12">
    <div class="flex items-end justify-between gap-4 flex-wrap mb-4">
      <div>
        <h2 class="text-xl font-semibold">Utvalda verktyg</h2>
        <p class={`text-sm mt-1 ${subtle}`}>Lär dig genom att stoppa in dina egna siffror.</p>
      </div>
      <a href="/verktyg/" class={`text-sm ${subtle} hover:text-[var(--gold)] transition`}>Visa alla →</a>
    </div>

    <div class="grid gap-5 md:grid-cols-2 xl:grid-cols-3">
      {tools.slice(0, 6).map((t) => (
        <a href={t.href} class={card} aria-label={`Öppna: ${t.title}`}>
          <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">{t.title}</h3>
          <p class={`text-sm mt-2 leading-relaxed ${subtle}`}>{t.desc}</p>
          <ul class="mt-4 space-y-2 text-sm">
            {t.bullets.map((b) => (
              <li class="flex gap-3">
                <span class="text-[var(--gold)]">›</span>
                <span class={subtle}>{b}</span>
              </li>
            ))}
          </ul>
          <div class={`mt-5 text-sm hover:text-[var(--gold)] transition ${subtle}`}>Öppna →</div>
        </a>
      ))}
    </div>

    <div class="mt-5 grid gap-5 md:grid-cols-2">
      {tools.slice(6).map((t) => (
        <a href={t.href} class={card} aria-label={`Öppna: ${t.title}`}>
          <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">{t.title}</h3>
          <p class={`text-sm mt-2 leading-relaxed ${subtle}`}>{t.desc}</p>
          <ul class="mt-4 space-y-2 text-sm">
            {t.bullets.map((b) => (
              <li class="flex gap-3">
                <span class="text-[var(--gold)]">›</span>
                <span class={subtle}>{b}</span>
              </li>
            ))}
          </ul>
          <div class={`mt-5 text-sm hover:text-[var(--gold)] transition ${subtle}`}>Öppna →</div>
        </a>
      ))}
    </div>
  </section>

  <!-- BÖRJA MED KUNSKAP -->
  <section class="pb-12">
    <div class="flex items-end justify-between gap-4 flex-wrap mb-4">
      <div>
        <h2 class="text-xl font-semibold">Börja med kunskap</h2>
        <p class={`text-sm mt-1 ${subtle}`}>Kärnguiderna som sätter ramen innan du optimerar.</p>
      </div>
      <a href="/kunskap/" class={`text-sm ${subtle} hover:text-[var(--gold)] transition`}>All kunskap →</a>
    </div>

    <div class="grid gap-5 md:grid-cols-3">
      {featuredPosts.map((p) => (
        <a href={`/kunskap/${p.slug}/`} class={card} aria-label={`Öppna: ${p.data.title}`}>
          <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">{p.data.title}</h3>
          <p class={`text-sm mt-2 leading-relaxed ${subtle}`}>{p.data.excerpt}</p>
          <div class={`mt-5 text-sm hover:text-[var(--gold)] transition ${subtle}`}>Läs →</div>
        </a>
      ))}
    </div>

    {!featuredPosts.length ? (
      <div class={`${sectionCard} p-6 ${subtle}`}>
        Skapa först K1-artiklarna i <code>src/content/kunskap/</code> så dyker de upp här.
      </div>
    ) : null}
  </section>

  <!-- RESURSER -->
  <section class="pb-14">
    <div class="flex items-end justify-between gap-4 flex-wrap mb-4">
      <div>
        <h2 class="text-xl font-semibold">Resurser</h2>
        <p class={`text-sm mt-1 ${subtle}`}>
          Exempel på tjänster och verktyg som kan passa – beroende på hur du valt att strukturera din ekonomi.
        </p>
      </div>
      <a href="/resurser/" class={`text-sm ${subtle} hover:text-[var(--gold)] transition`}>Alla resurser →</a>
    </div>

    <div class="grid gap-5 md:grid-cols-3">
      {featuredResources.map((x) => (
        <div class={card}>
          <div class="flex items-center justify-between gap-3 mb-2">
            <h3 class="text-base font-semibold">{x.title}</h3>
            <span class="text-xs px-2 py-1 rounded-full border border-[var(--border)] bg-[var(--surface-soft)]">
              {x.item ? x.item.data.type : "saknas"}
            </span>
          </div>

          {x.item ? (
            <>
              <a
                href={`/resurser/${x.item.slug}/`}
                class="block"
                aria-label={`Öppna resurs: ${x.item.data.title}`}
              >
                <div class="text-lg font-semibold hover:text-[var(--gold)] transition">
                  {x.item.data.title}
                </div>
                <p class={`text-sm mt-2 leading-relaxed ${subtle}`}>{x.item.data.excerpt}</p>
              </a>

              <div class={`mt-5 text-sm hover:text-[var(--gold)] transition ${subtle}`}>
                Öppna →
              </div>
            </>
          ) : (
            <p class={`text-sm ${subtle}`}>
              Saknas: <code>src/content/resurser/{x.slug}.md</code>
            </p>
          )}
        </div>
      ))}
    </div>

    <p class={`mt-4 text-xs ${subtle}`}>
      Obs: vissa länkar kan vara affiliate-länkar. Det påverkar inte priset för dig. Kharon AB. Mattias Karls, mattias.karls@gmail.com
    </p>
  </section>
</BaseLayout>
