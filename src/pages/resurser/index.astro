---
// src/pages/resurser/index.astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allResources = await getCollection("resurser");
type Resource = (typeof allResources)[number];

const bySlug = new Map<string, Resource>(allResources.map((r) => [r.slug, r]));

const rLysa = bySlug.get("lysa");
const rAvanza = bySlug.get("avanza");
const rMinPension = bySlug.get("minpension");
const rBook = bySlug.get("the-simple-path-to-wealth");

const ORDER = ["lysa", "avanza", "minpension", "the-simple-path-to-wealth"];
const orderSet = new Set<string>(ORDER);

const others: Resource[] = allResources
  .filter((r) => !orderSet.has(r.slug))
  .sort((a, b) => {
    const fa = a.data.featured === true ? 1 : 0;
    const fb = b.data.featured === true ? 1 : 0;
    return fb - fa;
  });

const sectionCard =
  "rounded-2xl border border-[var(--border)] bg-[var(--surface)]/70";
const resourceCard =
  "rounded-2xl border border-[var(--border)] bg-[var(--surface)] p-5 transition hover:border-[var(--gold)]";
const textLink =
  "text-sm text-[var(--text-muted)] hover:text-[var(--gold)] transition";
---

<BaseLayout title="Resurser – EkonomiSmedjan">
  <header class="space-y-3 pb-8">
    <div class="flex items-end justify-between gap-4 flex-wrap">
      <h1 class="text-2xl font-semibold">Resurser</h1>
      <span class="text-xs text-[var(--text-muted)]">
        {allResources.length} resurser
      </span>
    </div>

    <p class="text-[var(--text-muted)] max-w-3xl">
      Resurserna här är inte rekommendationer. De är exempel på verktyg,
      plattformar och böcker som kan passa – beroende på hur du valt att
      strukturera din ekonomi.
    </p>

    <a href="/kunskap/tanka-kring-sparande/" class={textLink}>
      Läs först: Hur du ska tänka →
    </a>
  </header>

  <section class="space-y-10">
    <!-- Automatiserat sparande -->
    <div class="space-y-4">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <h2 class="text-lg font-semibold">Automatiserat sparande</h2>
        <span class="text-xs text-[var(--text-muted)]">Autopilot</span>
      </div>

      {rLysa ? (
        <article class={resourceCard}>
          <a
            href={`/resurser/${rLysa.slug}/`}
            class="block rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--focus)]"
            aria-label={`Öppna: ${rLysa.data.title}`}
          >
            <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">
              {rLysa.data.title}
            </h3>
            <p class="text-sm mt-1 leading-relaxed text-[var(--text-muted)]">
              {rLysa.data.excerpt}
            </p>
          </a>
        </article>
      ) : (
        <div class={`${sectionCard} p-5 text-sm text-[var(--text-muted)]`}>
          Saknas: /resurser/lysa/
        </div>
      )}
    </div>

    <!-- Välj själv -->
    <div class="space-y-4">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <h2 class="text-lg font-semibold">Välj själv</h2>
        <span class="text-xs text-[var(--text-muted)]">Kontroll</span>
      </div>

      {rAvanza ? (
        <article class={resourceCard}>
          <a
            href={`/resurser/${rAvanza.slug}/`}
            class="block rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--focus)]"
            aria-label={`Öppna: ${rAvanza.data.title}`}
          >
            <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">
              {rAvanza.data.title}
            </h3>
            <p class="text-sm mt-1 leading-relaxed text-[var(--text-muted)]">
              {rAvanza.data.excerpt}
            </p>
          </a>
        </article>
      ) : (
        <div class={`${sectionCard} p-5 text-sm text-[var(--text-muted)]`}>
          Saknas: /resurser/avanza/
        </div>
      )}
    </div>

    <!-- Överblick & fakta -->
    <div class="space-y-4">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <h2 class="text-lg font-semibold">Överblick & fakta</h2>
        <span class="text-xs text-[var(--text-muted)]">Nuläge</span>
      </div>

      {rMinPension ? (
        <article class={resourceCard}>
          <a
            href={`/resurser/${rMinPension.slug}/`}
            class="block rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--focus)]"
            aria-label={`Öppna: ${rMinPension.data.title}`}
          >
            <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">
              {rMinPension.data.title}
            </h3>
            <p class="text-sm mt-1 leading-relaxed text-[var(--text-muted)]">
              {rMinPension.data.excerpt}
            </p>
          </a>
        </article>
      ) : (
        <div class={`${sectionCard} p-5 text-sm text-[var(--text-muted)]`}>
          Saknas: /resurser/minpension/
        </div>
      )}
    </div>

    <!-- Fördjupning -->
    <div class="space-y-4">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <h2 class="text-lg font-semibold">Fördjupning</h2>
        <span class="text-xs text-[var(--text-muted)]">Perspektiv</span>
      </div>

      {rBook ? (
        <article class={resourceCard}>
          <a
            href={`/resurser/${rBook.slug}/`}
            class="block rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--focus)]"
            aria-label={`Öppna: ${rBook.data.title}`}
          >
            <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">
              {rBook.data.title}
            </h3>
            <p class="text-sm mt-1 leading-relaxed text-[var(--text-muted)]">
              {rBook.data.excerpt}
            </p>
          </a>
        </article>
      ) : (
        <div class={`${sectionCard} p-5 text-sm text-[var(--text-muted)]`}>
          Saknas: /resurser/the-simple-path-to-wealth/
        </div>
      )}
    </div>

    <!-- Övriga resurser -->
    {others.length ? (
      <div class="space-y-4">
        <div class="flex items-end justify-between gap-4 flex-wrap">
          <h2 class="text-lg font-semibold">Övrigt</h2>
          <span class="text-xs text-[var(--text-muted)]">{others.length} st</span>
        </div>

        <div class="grid gap-5">
          {others.map((r) => (
            <article class={resourceCard}>
              <a
                href={`/resurser/${r.slug}/`}
                class="block rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--focus)]"
                aria-label={`Öppna: ${r.data.title}`}
              >
                <h3 class="text-lg font-semibold hover:text-[var(--gold)] transition">
                  {r.data.title}
                </h3>
                <p class="text-sm mt-1 leading-relaxed text-[var(--text-muted)]">
                  {r.data.excerpt}
                </p>
              </a>
            </article>
          ))}
        </div>
      </div>
    ) : null}
  </section>
</BaseLayout>
