<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UT...-8" />
  <title>Jag och mitt AB – Lön vs utdelning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind (standalone tool) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #0b0c0f;
      --panel: rgba(17, 24, 39, 0.55);
      --panel2: rgba(2, 6, 23, 0.55);
      --border: rgba(148, 163, 184, 0.14);
      --text: #e5e7eb;
      --muted: rgba(229, 231, 235, 0.65);
      --accent: #eab308;
      --accent2: #38bdf8;
      --danger: #f97316;
    }
    body {
      background: transparent;
      color: var(--text);
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
    }
    .card2 {
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 18px;
    }
    .pill {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(2, 6, 23, 0.35);
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }
    .pill strong { color: var(--text); font-weight: 600; }
    .label { font-size: 12px; color: var(--muted); }
    .hint { font-size: 11px; color: rgba(229,231,235,0.45); }
    .input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.18);
      background: rgba(2,6,23,0.35);
      color: var(--text);
      outline: none;
    }
    .input:focus {
      border-color: rgba(56,189,248,0.6);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.15);
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.18);
      background: rgba(2,6,23,0.45);
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
    }
    .btn:hover { border-color: rgba(56,189,248,0.5); }
    .btn-primary {
      background: var(--accent);
      color: #000;
      border-color: #000;
    }
    .btn-primary:hover { filter: brightness(1.02); }
    .kpi {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 14px;
      border-radius: 16px;
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(148,163,184,0.16);
    }
    .kpi .val { font-size: 18px; font-weight: 700; color: var(--text); }
    .kpi .sub { font-size: 11px; color: rgba(229,231,235,0.55); }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }
    @media (max-width: 1024px) {
      .grid-3 { grid-template-columns: 1fr; }
      .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- OBS: Standalone <header> med egen meny är borttagen för inbäddning i Astro. -->

  <main class="max-w-7xl mx-auto px-4 md:px-6 py-8 space-y-8">
    <div class="flex items-center justify-between">
      <div class="flex items-start gap-3">
        <div class="h-8 w-8 rounded-full bg-emerald-600/20 border border-emerald-500/30 flex items-center justify-center text-emerald-200 font-bold text-sm">
          AB
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-semibold">Jag och mitt AB</h1>
          <p class="text-sm text-slate-400">Optimering mellan lön, utdelning & tjänstepension</p>
        </div>
      </div>

      <div class="hidden md:block text-right">
        <div class="text-xs text-slate-400">Förenklad modell. Ger känsla för effekter – inte skatterådgivning.</div>
      </div>
    </div>

    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="pill"><strong>1</strong> Företagets siffror</div>
        <div class="pill"><strong>2</strong> Din privata ekonomi</div>
        <div class="pill"><strong>3</strong> Scenario: extra lön, utdelning & tjänstepension</div>
      </div>
      <div class="text-xs text-slate-400 hidden md:block">
        Tips: Ändra fritt – allt räknas om direkt.
      </div>
    </div>

    <section class="grid-3">
      <!-- Left column -->
      <div class="space-y-4">
        <div class="card p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">1. Företagets siffror (AB)</h2>
            <div class="hint">Förenklad resultaträkning före dina nya beslut.</div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Omsättning i (kr)</div>
              <input id="rev" class="input" type="number" value="2000000" />
            </div>

            <div class="space-y-2">
              <div class="label">Övriga kostnader exkl din lön & tjänstepension (kr)</div>
              <input id="otherCosts" class="input" type="number" value="600000" />
              <div class="hint">T.ex. lokaler, bokföring, resor, underkonsulter.</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Din lön hittills i år (brutto, kr)</div>
              <input id="salaryYtd" class="input" type="number" value="600000" />
            </div>

            <div class="space-y-2">
              <div class="label">Arbetsgivaravgift (%)</div>
              <input id="payrollTax" class="input" type="number" step="0.01" value="31.42" />
            </div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Bolagsskatt (%)</div>
              <input id="corpTax" class="input" type="number" step="0.1" value="20.6" />
            </div>

            <div class="space-y-2">
              <div class="label">Särskild löneskatt på pension (%)</div>
              <input id="sltp" class="input" type="number" step="0.01" value="24.26" />
              <div class="hint">På pensionspremier. Förenklad schablon – ändra vid behov.</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Upparbetat utdelningsutrymme (kr)</div>
              <input id="divAllowanceCarry" class="input" type="number" value="0" />
              <div class="hint">Sparat gränsbelopp från tidigare år.</div>
            </div>

            <div class="space-y-2">
              <div class="label">Årets gränsbelopp (kr)</div>
              <input id="divAllowanceYear" class="input" type="number" value="209000" />
              <div class="hint">Schablon eller löneunderlag – fyll i ditt faktiska belopp.</div>
            </div>
          </div>

          <div class="grid-3">
            <div class="kpi">
              <div class="sub">RESULTAT FÖRE SKATT (BAS)</div>
              <div class="val" id="kpiResBeforeTaxBase">—</div>
            </div>
            <div class="kpi">
              <div class="sub">Totalt utdelningsutrymme</div>
              <div class="val" id="kpiDivAllowance">—</div>
            </div>
            <div class="kpi">
              <div class="sub">Max utdelning (vinst & utrymme)</div>
              <div class="val" id="kpiDivMax">—</div>
            </div>
          </div>
        </div>

        <div class="card p-5 space-y-4">
          <h2 class="font-semibold">2. Din privata ekonomi</h2>
          <div class="hint">
            Skatt & tjänstepension. Grundavdrag & jobbskatteavdrag sätts schablonmässigt utifrån ålder men kan justeras.
          </div>

          <div class="grid-3">
            <div class="space-y-2">
              <div class="label">Ålder (år)</div>
              <input id="age" class="input" type="number" value="45" />
              <div class="hint">Används för att förenkla grundavdrag & jobbskatteavdrag.</div>
            </div>

            <div class="space-y-2">
              <div class="label">Kommunalskatt (%)</div>
              <input id="munTax" class="input" type="number" step="0.1" value="32" />
            </div>

            <div class="space-y-2">
              <div class="label">Statlig skatt på lön över brytpunkt (%)</div>
              <input id="stateTax" class="input" type="number" step="0.1" value="20" />
              <div class="hint">Ungefärlig nivå, ovanpå kommunalskatten.</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Brytpunkt statlig skatt (kr/år)</div>
              <input id="stateTaxThreshold" class="input" type="number" value="598500" />
              <div class="hint">Justera vid behov.</div>
            </div>

            <div class="space-y-2">
              <div class="label">Skatt på utdelning i gränsbelopp (%)</div>
              <input id="divTax" class="input" type="number" step="0.1" value="20" />
              <div class="hint">3:12 inom gränsbelopp beskattas normalt 20%.</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="space-y-2">
              <div class="label">Grundavdrag (kr/år, schablon)</div>
              <input id="basicDeduction" class="input" type="number" value="15000" />
            </div>

            <div class="space-y-2">
              <div class="label">Jobbskatteavdrag (kr/år, schablon)</div>
              <input id="earnedIncomeCredit" class="input" type="number" value="45000" />
            </div>
          </div>

          <div class="hint">
            Obs: Detta är grovt förenklat. Målet är att jämföra scenarier, inte att bli exakt på kronan.
          </div>
        </div>
      </div>

      <!-- Right column: scenario + results -->
      <div class="lg:col-span-2 space-y-4">
        <div class="card p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">3. Scenario: extra lön, utdelning & tjänstepension</h2>
            <div class="pill"><span class="h-2 w-2 rounded-full bg-emerald-400"></span> Lön + utdelning + pension</div>
          </div>

          <div class="grid-3">
            <div class="space-y-2">
              <div class="label">Extra lön i år (kr)</div>
              <input id="extraSalary" class="input" type="number" value="0" />
            </div>
            <div class="space-y-2">
              <div class="label">Utdelning i år (kr)</div>
              <input id="dividend" class="input" type="number" value="0" />
            </div>
            <div class="space-y-2">
              <div class="label">Årets tjänstepension (kr)</div>
              <input id="pension" class="input" type="number" value="60000" />
              <div class="hint">Företaget betalar premie (kostnad + särskild löneskatt).</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="card2 p-5 space-y-3">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Resultat: Du privat (scenario)</h3>
                <div class="pill"><span class="h-2 w-2 rounded-full bg-emerald-400"></span> Lön + utdelning + pension</div>
              </div>

              <div class="grid-2">
                <div class="kpi">
                  <div class="sub">NETTOLÖN EFTER SKATT</div>
                  <div class="val" id="kpiNetSalary">—</div>
                  <div class="sub text-right">inkl. extra lön</div>
                </div>

                <div class="kpi">
                  <div class="sub">NETTO-UTDELNING</div>
                  <div class="val" id="kpiNetDividend">—</div>
                  <div class="sub text-right">efter 20 % skatt</div>
                </div>
              </div>

              <div class="kpi" style="border-color: rgba(34,197,94,0.35); background: rgba(34,197,94,0.08);">
                <div class="sub">TOTALT NETTO TILL DIG I ÅR</div>
                <div class="val" id="kpiTotalNetToYou">—</div>
                <div class="sub flex justify-between">
                  <span>Kön + utdelning (exkl. framtida pension)</span>
                  <span class="text-slate-400">+ pension</span>
                </div>
              </div>

              <div class="kpi">
                <div class="sub">ÅRETS TJÄNSTEPENSION (SCENARIO)</div>
                <div class="val" id="kpiPension">—</div>
                <div class="sub text-right">skattas först när du tar ut den</div>
              </div>
            </div>

            <div class="card2 p-5 space-y-3">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Resultat: Bolaget & skatter</h3>
                <div class="pill">Scenario vs bas</div>
              </div>

              <div class="kpi">
                <div class="sub">RESULTAT FÖRE SKATT (SCENARIO)</div>
                <div class="val" id="kpiResBeforeTaxScenario">—</div>
                <div class="sub text-right">efter lön & tjänstepension</div>
              </div>

              <div class="kpi">
                <div class="sub">BOLAGSSKATT (SCENARIO)</div>
                <div class="val" id="kpiCorpTaxScenario">—</div>
                <div class="sub text-right">0 kr om resultat ≤ 0</div>
              </div>

              <div class="kpi">
                <div class="sub">VINST EFTER SKATT (SCENARIO)</div>
                <div class="val" id="kpiProfitAfterTaxScenario">—</div>
                <div class="sub text-right">före utdelning</div>
              </div>

              <div class="kpi">
                <div class="sub">ARBETSGIVARAVGIFTER (ÅR, SCENARIO)</div>
                <div class="val" id="kpiPayrollTaxScenario">—</div>
                <div class="sub text-right">på din lön hittills + extra lön</div>
              </div>

              <div class="kpi">
                <div class="sub">KVAR I BOLAGET EFTER UTDELNING (SCENARIO)</div>
                <div class="val" id="kpiLeftInCompany">—</div>
                <div class="sub text-right">kan sparas till framtida år</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">Graf (översikt)</h2>
            <div class="hint">Visar netto till dig + kvar i bolaget (scenario).</div>
          </div>
          <div class="card2 p-4">
            <canvas id="chart" height="120"></canvas>
          </div>
        </div>

      </div>
    </section>

    <footer class="text-xs text-slate-500 pt-2">
      Förenklad modell. För beslut: kontrollera med bokföring/skatterådgivare och uppdatera antaganden.
    </footer>
  </main>

  <script>
    // ---------- Utilities ----------
    const fmt = (n) =>
      new Intl.NumberFormat("sv-SE", { maximumFractionDigits: 0 }).format(
        Math.round(n)
      ) + " kr";

    const num = (id) => Number(document.getElementById(id).value || 0);

    // Schablon: statlig skatt på del av lön över brytpunkt (utan värnskatt).
    const incomeTax = (grossSalary, munTax, stateTax, stateThreshold, basicDeduction, earnedIncomeCredit) => {
      const taxable = Math.max(0, grossSalary - basicDeduction);
      const municipal = taxable * (munTax / 100);
      const statePart = Math.max(0, taxable - stateThreshold) * (stateTax / 100);
      const preCredit = municipal + statePart;
      const afterCredit = Math.max(0, preCredit - earnedIncomeCredit);
      return afterCredit;
    };

    // ---------- Model ----------
    let chart;

    function recalc() {
      const rev = num("rev");
      const otherCosts = num("otherCosts");
      const salaryYtd = num("salaryYtd");
      const payrollTax = num("payrollTax");
      const corpTax = num("corpTax");
      const sltp = num("sltp");
      const divAllowanceCarry = num("divAllowanceCarry");
      const divAllowanceYear = num("divAllowanceYear");

      const age = num("age"); // currently only used indirectly (manual inputs)
      const munTax = num("munTax");
      const stateTax = num("stateTax");
      const stateThreshold = num("stateTaxThreshold");
      const divTax = num("divTax");
      const basicDeduction = num("basicDeduction");
      const earnedIncomeCredit = num("earnedIncomeCredit");

      const extraSalary = num("extraSalary");
      const dividend = num("dividend");
      const pension = num("pension");

      // Base company result before any new scenario decisions:
      const basePayrollTaxes = salaryYtd * (payrollTax / 100);
      const resBeforeTaxBase =
        rev - otherCosts - salaryYtd - basePayrollTaxes;

      const totalAllowance = divAllowanceCarry + divAllowanceYear;
      const maxDivByAllowance = Math.max(0, totalAllowance);
      // Max dividend also limited by distributable profit (simplified: profit after tax + existing equity ignored)
      // Here we show "max" as min(allowance, profit after tax if profit positive).
      const baseCorpTax = Math.max(0, resBeforeTaxBase) * (corpTax / 100);
      const baseProfitAfterTax = resBeforeTaxBase - baseCorpTax;
      const maxDivByProfit = Math.max(0, baseProfitAfterTax);
      const maxDiv = Math.max(0, Math.min(maxDivByAllowance, maxDivByProfit));

      document.getElementById("kpiResBeforeTaxBase").textContent = fmt(resBeforeTaxBase);
      document.getElementById("kpiDivAllowance").textContent = fmt(totalAllowance);
      document.getElementById("kpiDivMax").textContent = fmt(maxDiv);

      // Scenario:
      const scenSalaryTotal = salaryYtd + extraSalary;
      const scenPayrollTaxes = scenSalaryTotal * (payrollTax / 100);
      const scenPensionCost = pension * (1 + sltp / 100);

      const resBeforeTaxScenario =
        rev - otherCosts - scenSalaryTotal - scenPayrollTaxes - scenPensionCost;

      const corpTaxScenario = Math.max(0, resBeforeTaxScenario) * (corpTax / 100);
      const profitAfterTaxScenario = resBeforeTaxScenario - corpTaxScenario;

      // Dividend capped by allowance and available profits (simplified)
      const dividendAllowed = Math.min(dividend, totalAllowance);
      const dividendFromProfit = Math.min(dividendAllowed, Math.max(0, profitAfterTaxScenario));
      const dividendTax = dividendFromProfit * (divTax / 100);
      const netDividend = dividendFromProfit - dividendTax;

      // Salary tax
      const salaryTax = incomeTax(
        scenSalaryTotal,
        munTax,
        stateTax,
        stateThreshold,
        basicDeduction,
        earnedIncomeCredit
      );
      const netSalary = scenSalaryTotal - salaryTax;

      const totalNetToYou = netSalary + netDividend;

      // Cash left in company after dividend
      const leftInCompany = profitAfterTaxScenario - dividendFromProfit;

      // Update KPIs
      document.getElementById("kpiNetSalary").textContent = fmt(netSalary);
      document.getElementById("kpiNetDividend").textContent = fmt(netDividend);
      document.getElementById("kpiTotalNetToYou").textContent = fmt(totalNetToYou);
      document.getElementById("kpiPension").textContent = fmt(pension);

      document.getElementById("kpiResBeforeTaxScenario").textContent = fmt(resBeforeTaxScenario);
      document.getElementById("kpiCorpTaxScenario").textContent = fmt(corpTaxScenario);
      document.getElementById("kpiProfitAfterTaxScenario").textContent = fmt(profitAfterTaxScenario);
      document.getElementById("kpiPayrollTaxScenario").textContent = fmt(scenPayrollTaxes);
      document.getElementById("kpiLeftInCompany").textContent = fmt(leftInCompany);

      // Chart
      const labels = ["Netto till dig", "Kvar i bolaget", "Pension (avsatt)"];
      const data = [totalNetToYou, leftInCompany, pension];

      const ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "Scenario (kr)",
              data,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (ctx) => fmt(ctx.parsed.y),
              },
            },
          },
          scales: {
            x: {
              ticks: { color: "rgba(229,231,235,0.75)" },
              grid: { color: "rgba(148,163,184,0.10)" },
            },
            y: {
              ticks: {
                color: "rgba(229,231,235,0.75)",
                callback: (v) => new Intl.NumberFormat("sv-SE").format(v),
              },
              grid: { color: "rgba(148,163,184,0.10)" },
            },
          },
        },
      });
    }

    // Hook up listeners
    const ids = [
      "rev","otherCosts","salaryYtd","payrollTax","corpTax","sltp",
      "divAllowanceCarry","divAllowanceYear",
      "age","munTax","stateTax","stateTaxThreshold","divTax","basicDeduction","earnedIncomeCredit",
      "extraSalary","dividend","pension"
    ];
    ids.forEach((id) => document.getElementById(id).addEventListener("input", recalc));

    recalc();
  </script>
</body>
</html>
